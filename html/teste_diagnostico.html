<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Diagn√≥stico Firebase</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a2e;
            color: #eee;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #16213e;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        h1 {
            color: #ffd700;
            text-align: center;
            margin-bottom: 30px;
        }
        .info {
            background: #0f3460;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #ffd700;
        }
        .success { border-left-color: #28a745; }
        .error { border-left-color: #dc3545; }
        .warning { border-left-color: #ffc107; }
        
        #console-output {
            background: #000;
            color: #0f0;
            padding: 20px;
            border-radius: 5px;
            font-size: 12px;
            height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
        }
        button {
            background: #ffd700;
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px 5px;
        }
        button:hover {
            background: #ffed4e;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¨ Teste de Diagn√≥stico Firebase</h1>
        
        <div class="info">
            <strong>üìã Instru√ß√µes:</strong><br>
            1. Fa√ßa login como admin primeiro<br>
            2. Clique em "Executar Teste"<br>
            3. Veja os resultados abaixo<br>
            4. Copie TUDO e envie para o Claude
        </div>
        
        <div style="text-align: center;">
            <button onclick="executarTeste()">üöÄ Executar Teste</button>
            <button onclick="copiarLogs()">üìã Copiar Logs</button>
            <button onclick="limparLogs()">üóëÔ∏è Limpar</button>
        </div>
        
        <h2>Console Output:</h2>
        <div id="console-output"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            getDocs,
            doc,
            getDoc
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { 
            getAuth, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBiguKTELhL6nJHyi52p7QkhG2BS_dpQJA",
            authDomain: "papelaria-f49d8.firebaseapp.com",
            projectId: "papelaria-f49d8",
            storageBucket: "papelaria-f49d8.firebasestorage.app",
            messagingSenderId: "309560032967",
            appId: "1:309560032967:web:b6bee43e2f57c1dd5f6c88"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        const output = document.getElementById('console-output');

        function log(msg, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            output.innerHTML += `[${timestamp}] ${msg}\n`;
            output.scrollTop = output.scrollHeight;
        }

        window.executarTeste = async function() {
            output.innerHTML = '';
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            log('üî¨ TESTE DE DIAGN√ìSTICO COMPLETO');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            log('');

            const user = auth.currentUser;
            
            if (!user) {
                log('‚ùå USU√ÅRIO N√ÉO AUTENTICADO!');
                log('   Por favor, fa√ßa login como admin primeiro.');
                log('   URL: http://127.0.0.1:5501/html/login.html');
                return;
            }

            log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
            log('üìã TESTE 1: Verificar Projeto Firebase');
            log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
            log('Config enviada:');
            log('  projectId: ' + firebaseConfig.projectId);
            log('  authDomain: ' + firebaseConfig.authDomain);
            log('');
            log('Firestore configurado:');
            log('  app.options.projectId: ' + app.options.projectId);
            log('  db._databaseId.projectId: ' + db._databaseId?.projectId);
            log('  db._databaseId.database: ' + db._databaseId?.database);
            log('');

            log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
            log('üîê TESTE 2: Verificar Autentica√ß√£o');
            log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
            log('‚úÖ Usu√°rio AUTENTICADO');
            log('  Email: ' + user.email);
            log('  UID: ' + user.uid);
            log('  Provider: ' + user.providerData[0]?.providerId);
            log('');

            log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
            log('üìÑ TESTE 3: Buscar Documento Espec√≠fico');
            log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
            log('Tentando buscar: feedbacks/F14mBOwH2eJe4G9Cy9C5');
            log('');
            
            try {
                const docRef = doc(db, 'feedbacks', 'F14mBOwH2eJe4G9Cy9C5');
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    log('‚úÖ DOCUMENTO ENCONTRADO!');
                    log('  Dados: ' + JSON.stringify(docSnap.data(), null, 2));
                    log('  Fonte: ' + (docSnap.metadata.fromCache ? 'CACHE ‚ö†Ô∏è' : 'SERVIDOR ‚úÖ'));
                } else {
                    log('‚ùå DOCUMENTO N√ÉO EXISTE!');
                    log('  ‚ö†Ô∏è Isso significa que estamos no PROJETO ERRADO!');
                }
            } catch (error) {
                log('‚ùå ERRO ao buscar documento:');
                log('  C√≥digo: ' + error.code);
                log('  Mensagem: ' + error.message);
            }
            
            log('');

            log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
            log('üìã TESTE 4: Listar TODOS os Feedbacks (SEM orderBy)');
            log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
            
            try {
                const feedbacksRef = collection(db, 'feedbacks');
                log('üìÅ Refer√™ncia criada: ' + feedbacksRef.path);
                
                log('‚è≥ Executando getDocs()...');
                const snapshot = await getDocs(feedbacksRef);
                
                log('üìä Resultado:');
                log('  Total de documentos: ' + snapshot.size);
                log('  Vazio? ' + snapshot.empty);
                log('  Fonte: ' + (snapshot.metadata.fromCache ? 'CACHE ‚ö†Ô∏è' : 'SERVIDOR ‚úÖ'));
                log('');
                
                if (snapshot.size > 0) {
                    log('‚úÖ DOCUMENTOS ENCONTRADOS!');
                    log('');
                    snapshot.forEach((doc, index) => {
                        const data = doc.data();
                        log(`  ${index + 1}. Doc ID: ${doc.id}`);
                        log('     userName: ' + data.userName);
                        log('     userEmail: ' + data.userEmail);
                        log('     status: ' + data.status);
                        log('     timestamp: ' + data.timestamp);
                        log('');
                    });
                } else {
                    log('‚ùå NENHUM DOCUMENTO ENCONTRADO!');
                    log('');
                    log('üîç POSS√çVEIS CAUSAS:');
                    log('  1. Projeto Firebase errado');
                    log('  2. Database errado');
                    log('  3. Cole√ß√£o com nome diferente');
                    log('  4. Cache offline vazio');
                    log('');
                }
                
            } catch (error) {
                log('‚ùå ERRO ao listar feedbacks:');
                log('  C√≥digo: ' + error.code);
                log('  Mensagem: ' + error.message);
                log('  Stack: ' + error.stack);
            }

            log('');
            log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
            log('üèÅ TESTES CONCLU√çDOS');
            log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
            log('');
            log('üìù RESUMO:');
            log('  ‚úÖ Projeto configurado: ' + app.options.projectId);
            log('  ‚úÖ Usu√°rio autenticado: ' + user.email);
            log('  ‚ùì Documentos encontrados: Veja acima');
            log('');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            log('');
            log('üëâ COPIE TUDO ACIMA E ENVIE PARA O CLAUDE');
        };

        window.copiarLogs = function() {
            const text = output.innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Logs copiados! Cole e envie para o Claude.');
            });
        };

        window.limparLogs = function() {
            output.innerHTML = '';
            log('Console limpo. Clique em "Executar Teste" para rodar novamente.');
        };

        // Auto-executar se j√° estiver logado
        onAuthStateChanged(auth, (user) => {
            if (user) {
                log('‚úÖ Usu√°rio detectado: ' + user.email);
                log('üëâ Clique em "Executar Teste" para come√ßar.');
            } else {
                log('‚ö†Ô∏è Nenhum usu√°rio logado.');
                log('üëâ Fa√ßa login primeiro: http://127.0.0.1:5501/html/login.html');
            }
        });
    </script>
</body>
</html>